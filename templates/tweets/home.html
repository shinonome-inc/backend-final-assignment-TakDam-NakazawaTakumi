{% extends "base.html" %}
{% block title %}
Home
{% endblock %}


{% block content %}

<h1>This is the home!</h1>
Tweet_number:{{tweets_number}}
{% for tweet in tweets_list %}
<p>
    <a href="{% url 'accounts:user_profile' tweet.user.username %}">{{tweet.user}}</a><br>
    {{ tweet.title }}<br>
    {{ tweet.content}}<br>
    {{ tweet.created_at }}
    <a>Like: <span id="ajax-like-count-{{tweet.number}}">{{tweet.n_liked }}</span></a>
    {% if tweet.liked %}
        <button id="ajax-unlike-{{tweet.number}}">Unlike</button>
    {% else %}
        <button id="ajax-like-{{tweet.number}}">Like</button>
    {% endif %}
    <a href="/tweets/{{tweet.number}}">Detail</a>
</p>
{% endfor %}
{% endblock %}
{% block extlascripts %}
<script>
{% for tweet in tweets_list %}
    p=document.getElementById(`ajax-like-{{tweet.number}}`)
    console.log(p)
    p.addEventListener("click",e=>{
        e.preventDefault();
        const url = `/tweets/{{tweet.id}}/like`;
        fetch(
            url,{
                method:"POST",
                body:`pk={{tweet.id}}`,
                headers:{
                    'Content-Type':'application/x-www-form-urlencoded; charset=utf-8',
                    'X-CSRFToken':"{{ csrf_token }}"
                }
                }
        ).then(
            response=>{
                return response.json();
            }
        ).then(
            response=>{
                console.log(response);
            }
        );
    });
{% endfor %}
</script>
{% endblock %}
